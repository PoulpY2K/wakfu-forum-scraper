version: "3.9"
services:
  db:
    image: postgres:${POSTGRES_VERSION:-latest}
    container_name: "wakfu-scraper-db"
    restart: always
    volumes:
      - wakfu-scraper-db:/var/lib/postgresql/data:rw
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres" ]
      retries: 5
      timeout: 5s
      interval: 10s
    env_file:
      - .env

  wakfu-forum-scraper:
    build:
      context: .
      dockerfile: Dockerfile
    command: ["sh", "-c", "npx prisma migrate deploy && npm run watch"]
    container_name: "wakfu-forum-scraper"
    restart: always
    volumes:
      - .:/app
    depends_on:
      - db
    env_file:
      - .env

volumes:
  wakfu-scraper-db:
    external: true
    name: wakfu-scraper-db

networks:
  default:
    name: wakfu_network
